-- CREATE DATABASE School_System;
-- USE School_System; 


-- CREATE TABLE Schools (
-- 	id INT PRIMARY KEY AUTO_INCREMENT, 
-- 	name VARCHAR(30), 
-- 	mission VARCHAR(120), 
-- 	vision VARCHAR(120), 
-- 	language VARCHAR(20), 
-- 	general_info VARCHAR(120), 
-- 	fees INT, 
-- 	type VARCHAR(20), 
-- 	min_grade INT, 
-- 	max_grade INT, 
-- 	email VARCHAR(50), 
-- 	elementary BIT AS (min_grade = 1 AND max_grade >= 6) , 
-- 	middle BIT AS (min_grade <= 7 AND max_grade >= 9), 
-- 	high BIT AS (min_grade <= 10 AND max_grade = 12)
-- );  


-- CREATE TABLE Phone_Schools (
-- 	PRIMARY KEY (school_id, phone),
-- 	phone VARCHAR(15), 
-- 	school_id INT,
-- 	FOREIGN KEY (school_id) REFERENCES Schools(id) ON DELETE CASCADE 
	
-- ); 

-- CREATE TABLE Supplies (
-- 	PRIMARY KEY (name, school_id, grade),
-- 	name VARCHAR(15), 
-- 	school_id INT, 
-- 	grade INT,
-- 	FOREIGN KEY (school_id) REFERENCES Schools(id) ON DELETE CASCADE
-- ); 


CREATE TABLE Clubs (
	PRIMARY KEY (name, school_id), 
	name VARCHAR(20), 
	school_id INT,
	FOREIGN KEY (school_id) REFERENCES Schools(id) ON DELETE CASCADE
); 

-- CREATE TABLE Students (
-- 	PRIMARY KEY (ssn), 
-- 	ssn INT, 
-- 	school_id INT, 
-- 	first_name VARCHAR(20),
-- 	last_name VARCHAR(20), 
-- 	username VARCHAR(20),
-- 	password VARCHAR(20), 
-- 	gender VARCHAR(10), 
-- 	birthdate date, 
-- 	age INT AS (YEAR('2016-1-1') - YEAR(birthdate)), 
-- 	grade INT, 
-- 	level VARCHAR(15), 
-- 	FOREIGN KEY (school_id) REFERENCES Schools(id)
-- ); 

-- CREATE TABLE Parents (
-- 	PRIMARY KEY (username), 
-- 	username VARCHAR(20), 
-- 	first_name VARCHAR(20), 
-- 	last_name VARCHAR(20), 
-- 	email VARCHAR(20), 
-- 	address VARCHAR(120), 
-- 	home_phone VARCHAR(15)
-- ); 

-- CREATE TABLE Mobiles_Of_Parents (
-- 	PRIMARY KEY (mobile, username), 
-- 	username VARCHAR(20), 
-- 	mobile VARCHAR(15), 
-- 	FOREIGN KEY (username) REFERENCES Parents(username) ON DELETE CASCADE
-- );  


create database School-System;
use School-System;
create table Adminstrators
	(
		id int PRIMARY KEY AUTO_INCREMENT, 
		FOREIGN KEY (id) REFERENCES Employee(id) ON DELETE CASCADE
	);

create table Teachers 
	(
		id int PRIMARY KEY AUTO_INCREMENT,
		FOREIGN KEY (id) REFERENCES Employee(id) ON DELETE CASCADE,
		exp_years int,
		age int AS (YEAR(’2016-11-9’) - YEAR(start_date)) 
	);

create table Teachers_Supervising_Teachers
	(
		supervisor_id int,
		teacher_id int,
		PRIMARY KEY (supervisor_id, teacher_id),
		FOREIGN KEY (supervisor_id) REFERENCES Teachers(id) ON DELETE CASCADE,
		FOREIGN KEY (teacher_id) REFERENCES Teachers(id) ON DELETE CASCADE,
	);

create table Activities
	(
		activity_datetime datetime,
		location varchar(100),
		equipment varchar(100),
		description varchar(500),
		type varchar(40),
		admin_id int,
		teacher_id int,
		PRIMARY KEY (activity_datetime, location),
		FOREIGN KEY (admin_id) REFERENCES Adminstrators(id) ON DELETE CASCADE,
		FOREIGN KEY (teacher_id) REFERENCES Teachers(id) ON DELETE CASCADE
	);

create table Activities_JoinedBy_Students
	(
		student_ssn int,
		activity_datetime datetime,
		location varchar(100),
		PRIMARY KEY (student_ssn, activity_datetime, location),
		FOREIGN KEY (student_ssn) REFERENCES Students ON DELETE CASCADE,
		FOREIGN KEY (activity_datetime, location) REFERENCES Activities(activity_datetime, location) ON DELETE CASCADE
	);

create table Announcements
	(
		title varchar(50),
		announcement_date date,
		type varchar(50),
		descriptoin varchar(500),
		admin_id int,
		PRIMARY KEY (title, announcement_date),
		FOREIGN KEY (admin_id) REFERENCES Adminstrators(id) ON DELETE SET NULL
	);

create table Courses
	(
		code int,
		name varchar(50),
		description varchar(250),
		grade int,
		PRIMARY KEY (code)
	);

create table Courses_Prerequisite_Courses
	(
		pre_code int,
		code int,
		PRIMARY KEY (pre_code, code),
		FOREIGN KEY (pre_code) REFERENCES Courses(code) ON DELETE CASCADE,
		FOREIGN KEY (code) REFERENCES Courses(code) ON DELETE CASCADE
	);

create table Courses_TaughtIn_Schools
	(
		course_code int,
		school_id int,
		PRIMARY KEY (course_code, school_id),
		FOREIGN KEY (course_code) REFERENCES Courses(code) ON DELETE CASCADE,
		FOREIGN KEY (school_id) REFERENCES Schools(id) ON DELETE CASCADE
	);

create table Parents_Rate_Teachers
	(
		parent_username varchar (20),
		teacher_id int,
		rating int,
		PRIMARY KEY (parent_username, teacher_id),
		FOREIGN KEY (parent_username) REFERENCES Parents(username) ON DELETE CASCADE,
		FOREIGN KEY (teacher_id) REFERENCES Teachers(id) ON DELETE CASCADE
	);

create table Questions
	(
		q_id int,
		content varchar(250),
		student_ssn int,
		course_code int,
		PRIMARY KEY (q_id),
		FOREIGN KEY (student_ssn) REFERENCES Students(ssn) ON DELETE SET NULL,
		FOREIGN KEY (course_code) REFERENCES Courses(code) ON DELETE CASCADE
	);

create table Answers
	(
		answer_sub_id int,
		q_id int,
		answer varchar(250),
		teacher_id int,
		PRIMARY KEY (answer_sub_id, q_id),
		FOREIGN KEY (q_id) REFERENCES Questions(q_id) ON DELETE CASCADE,
		FOREIGN KEY (teacher_id) REFERENCES Teachers(id) ON DELETE SET NULL
	);

create table Courses_TaughtTo_Students_By_Teachers
	(
		course_code int,
		student_ssn int,
		teacher_id int,
		PRIMARY KEY (course_code, student_ssn),
		FOREIGN KEY (course_code) REFERENCES Courses(code) ON DELETE CASCADE,
		FOREIGN KEY (student_ssn) REFERENCES Students(ssn) ON DELETE CASCADE,
		FOREIGN KEY (teacher_id) REFERENCES Teachers(id) ON DELETE CASCADE
	);

create table Assignments
	(
		assignment_number int,
		course_code int,
		school_id int,
		post_date date,
		due_date date,
		contenet varchar(1000),
		teacher_id int,
		PRIMARY KEY (assignment_number, course_code, school_id),
		FOREIGN KEY (course_code) REFERENCES Courses(code) ON DELETE CASCADE,
		FOREIGN KEY (school_id) REFERENCES Schools(id) ON DELETE CASCADE,
		FOREIGN KEY (teacher_id) REFERENCES Teachers(id) ON DELETE CASCADE
	);

create table Solutions
	(
		student_ssn int,
		assignment_number int,
		course_code int,
		school_id int,
		solution varchar(500),
		PRIMARY KEY (student_ssn, assignment_number, course_code, school_id),
		FOREIGN KEY (student_ssn) REFERENCES Students(ssn) ON DELETE CASCADE,
		FOREIGN KEY (assignment_number, course_code, school_id) REFERENCES Assignments(assignment_number, course_code, school_id) ON
	);

create table Teachers_Grade_Solutions
	(
		student_ssn int,
		assignment_number int,
		course_code int,
		school_id int,
		grade int;
		teacher_id int,
		PRIMARY KEY (student_ssn, assignment_number, course_code, school_id),
		FOREIGN KEY (student_ssn, assignment_number, course_code, school_id) REFERENCES Solutions (student_ssn, assignment_number, course_code, school_id), ON DELETE CASCADE,
		FOREIGN KEY (teacher_id) REFERENCES Teachers(id) ON DELETE CASCADE	
	);

create table Reports
	(
		report_date date,
		student_ssn int,
		teacher_id int,
		comment varchar(500),
		PRIMARY KEY (report_date, student_ssn, teacher_id),
		FOREIGN KEY (student_ssn) REFERENCES Students(ssn) ON DELETE CASCADE,
		FOREIGN KEY (teacher_id) REFERENCES Teachers(id) ON DELETE CASCADE
	);

create table Parents_View_Reports
	(
		parent_username varchar(20),
		report_date date,
		student_ssn int,
		teacher_id int,
		PRIMARY KEY (parent_username, report_date, student_ssn, teacher_id),
		FOREIGN KEY (parent_username) REFERENCES Parents(username) ON DELETE CASCADE,
		FOREIGN KEY (report_date, student_ssn, teacher_id) REFERENCES Reports(report_date, student_ssn, teacher_id) ON DELETE CASCADE
	);

create table Parents_Reply_Reports
	(
		parent_username varchar(20),
		report_date date,
		student_ssn int,
		teacher_id int,
		content varchar(250),
		PRIMARY KEY (parent_username, report_date, student_ssn, teacher_id),
		FOREIGN KEY (parent_username) REFERENCES Parents(username) ON DELETE CASCADE,
		FOREIGN KEY (report_date, student_ssn, teacher_id) REFERENCES Reports(report_date, student_ssn, teacher_id) ON DELETE CASCADE
	);

